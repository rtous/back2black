
Computer Architecture Department							Ruben Tous
Universitat Politecnica de Catalunya                       
                                                              												  
															  
					back2black release manual 


1 MacOS

1.1 Per fer un release

    ./build_macos.sh
    ./release_macos.sh

1.1 Generate an MacOS Application Bundle

- Cal generar un MacOS Application Bundle
    - Es pot executar fent doble click o amb open (mirar més avall)
- Es pot fer mitjançant CMake (mirar CMake de l'editor)
- IMPORTANT: Per veure els logs cal executar desde terminal així:

    open build_macos/bin/test_applebundle.app/Contents/MacOS/test_applebundle 

- Per accedir als fitxers dins l'aplicació cal fer-ho amb una llibreria (mirar segmentor_sam2.cpp). 

1.2 Put the bundle within a DMG

- Can do it with the disk utility but better with:

(https://github.com/create-dmg/create-dmg)

brew install create-dmg

create-dmg \
--volname "Application Installer" \
--volicon "application_icon.icns" \
--background "installer_background.png" \
--window-pos 200 120 \
--window-size 800 400 \
--icon-size 100 \
--icon "Application.app" 200 190 \
--hide-extension "Application.app" \
--app-drop-link 600 185 \
"Application-Installer.dmg" \
"source_folder/"

create-dmg \
--volname "Lester Installer" \
--volicon "macos_release_assets/application_icon.icns" \
--background "macos_release_assets/installer_background.png" \
--window-pos 200 120 \
--window-size 800 400 \
--icon-size 100 \
--icon "editor.app" 200 190 \
--hide-extension "editor.app" \
--app-drop-link 600 185 \
"Lester-Installer.dmg" \
"build_macos/bin/"











---------------------------- OLD -----

- IMPORTANT: Es poden veure els errors a l'app Consola
    #include <syslog.h>

    O:

    sudo log show --last 1m

- IMPORTANT: Es pot executar des de terminal per veure els logs
    - ./build_macos/bin/test_applebundle.app/Contents/MacOS/test_applebundle

- Cal generar un MacOS Application Bundle
- Es pot fer mitjançant CMake
- No és el mateix fer-ho amb MACOSX_BUNDLE que amb CPACK_BUNDLE
    - MACOSX_BUNDLE with CPACK_BUNDLE

1.1 Amb MACOSX_BUNDLE:

LINK clau: https://discourse.cmake.org/t/how-to-add-resources-to-macos-bundle/9323

A tenir en compte:

a) Cal afegir al install de l'editor:

    install(TARGETS ${EXAMPLE_TARGET} RUNTIME BUNDLE DESTINATION ${CMAKE_SOURCE_DIR}/editor/release_macos)

No peta però no tinc clar que fa. Genera com una app però no funciona.
-------



-------
Links:

https://www.ferranpujolcamins.cat/2020/11/27/Notes-CMake-macOS-bundle.html

- Cal generar un application bundle: https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFBundles/BundleTypes/BundleTypes.html

foo.app/
    Contents/
        Info.plist
        MacOS/
            foo
        Resources/
            foo.icns

- Millor: fer-ho amb cmake
- Tutorial: https://bartkessels.net/cmake/building-a-qt-macos-bundle

- Alternativa: https://www.reddit.com/r/rust/comments/5od04d/how_to_make_macos_app_bundles/